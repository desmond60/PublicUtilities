# PublicUtilities



## Описание



Проект предназначен для расчета комменальных услуг (ХВС, ГВС, электроэнергия день/ночь). Поддерживается работа с периодами проживания жильцов и сохранение результатов в БД. 



## Основная логика

- **Контроллеры**: находится в папке `Controllers`

- `UtilitiesCalcController` - основной контроллер для запуска расчётов

- **Сервисы**: находятся в папке `Services`

- `UtilitiesCalcService` - содержит метод `UtilitiesCalcProcess`, выполняющий валидацию, расчёт и сохранение

- Методы `ColdWaterCalculation`, `HotWaterCalculation`, `ElectricityCalculation` - отдельные методы для расчета услуг

- **Модели/DTO**: находятся в папке `Models` и `Dtos`





## Работа с периодами

- Если переданы периоды (`ResidentPeriodDto`), они будут учитываться, если одна из услуг не имеет прибора (показание `0`)

Примеры JSON-файлов с корректными и ошибочными периодами находятся в папке `README/JsonPeriods`, там же приведены два `.txt` файла, в которых произведены расчеты за январь-февраль 2025 года, с показаниями и без.



## Сохранение в БД

- При установке флага `SaveToDb = true`, результаты автоматически сохраняются в БД:

- `Metrics` — сохраняются показатели приборов учёта.

- `CalculationResults` — сохраняются детализированные результаты по каждой услуге.

- `ResidentPeriods` — сохраняются периоды проживания, если какой-то прибор осутствует.

- Все сущности связаны с пользователем (`User`) через навигационные свойства и внешние ключи.



## Swagger

В проект подключен **Swagger (Swashbuckle.AspNetCore)** для удобного тестирования API.





